// Extracted from V8 JavaScript Engine for benchmarking purposes only.
// Original source: https://github.com/v8/v8/blob/main/src/strings/unicode.cc

// Copyright 2012 the V8 project authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.

#pragma once

#include <cstdint>

namespace v8_unicode {

using uchar = uint32_t;

static const int kStartBit = (1 << 30);
static const int kChunkBits = (1 << 13);

template <int D>
static inline uchar TableGet(const int32_t *table, int index) {
  return table[D * index];
}

static inline uchar GetEntry(int32_t entry) {
  return entry & (kStartBit - 1);
}

static inline bool IsStart(int32_t entry) {
  return (entry & kStartBit) != 0;
}

static bool LookupPredicate(const int32_t *table, uint16_t size, uchar chr) {
  static const int kEntryDist = 1;
  uint16_t value = chr & (kChunkBits - 1);
  unsigned int low = 0;
  unsigned int high = size - 1;
  while (high != low) {
    unsigned int mid = low + ((high - low) >> 1);
    uchar current_value = GetEntry(TableGet<kEntryDist>(table, mid));
    // If we've found an entry less than or equal to this one, and the
    // next one is not also less than this one, we've arrived.
    if ((current_value <= value) &&
        (mid + 1 == size ||
         GetEntry(TableGet<kEntryDist>(table, mid + 1)) > value)) {
      low = mid;
      break;
    } else if (current_value < value) {
      low = mid + 1;
    } else if (current_value > value) {
      // If we've just checked the bottom-most value and it's not
      // the one we're looking for, we're done.
      if (mid == 0)
        break;
      high = mid - 1;
    }
  }
  int32_t field = TableGet<kEntryDist>(table, low);
  uchar entry = GetEntry(field);
  bool is_start = IsStart(field);
  return (entry == value) || (entry < value && is_start);
}


static const uint16_t kUppercaseTable0Size = 455;
static const int32_t kUppercaseTable0[455] = {
    1073741889, 90, 1073742016, 214, 1073742040, 222,
    256, 258, 260, 262, 264, 266,
    268, 270, 272, 274, 276, 278,
    280, 282, 284, 286, 288, 290,
    292, 294, 296, 298, 300, 302,
    304, 306, 308, 310, 313, 315,
    317, 319, 321, 323, 325, 327,
    330, 332, 334, 336, 338, 340,
    342, 344, 346, 348, 350, 352,
    354, 356, 358, 360, 362, 364,
    366, 368, 370, 372, 374, 1073742200,
    377, 379, 381, 1073742209, 386, 388,
    1073742214, 391, 1073742217, 395, 1073742222, 401,
    1073742227, 404, 1073742230, 408, 1073742236, 413,
    1073742239, 416, 418, 420, 1073742246, 423,
    425, 428, 1073742254, 431, 1073742257, 435,
    437, 1073742263, 440, 444, 452, 455,
    458, 461, 463, 465, 467, 469,
    471, 473, 475, 478, 480, 482,
    484, 486, 488, 490, 492, 494,
    497, 500, 1073742326, 504, 506, 508,
    510, 512, 514, 516, 518, 520,
    522, 524, 526, 528, 530, 532,
    534, 536, 538, 540, 542, 544,
    546, 548, 550, 552, 554, 556,
    558, 560, 562, 1073742394, 571, 1073742397,
    574, 577, 1073742403, 582, 584, 586,
    588, 590, 880, 882, 886, 895,
    902, 1073742728, 906, 908, 1073742734, 911,
    1073742737, 929, 1073742755, 939, 975, 1073742802,
    980, 984, 986, 988, 990, 992,
    994, 996, 998, 1000, 1002, 1004,
    1006, 1012, 1015, 1073742841, 1018, 1073742845,
    1071, 1120, 1122, 1124, 1126, 1128,
    1130, 1132, 1134, 1136, 1138, 1140,
    1142, 1144, 1146, 1148, 1150, 1152,
    1162, 1164, 1166, 1168, 1170, 1172,
    1174, 1176, 1178, 1180, 1182, 1184,
    1186, 1188, 1190, 1192, 1194, 1196,
    1198, 1200, 1202, 1204, 1206, 1208,
    1210, 1212, 1214, 1073743040, 1217, 1219,
    1221, 1223, 1225, 1227, 1229, 1232,
    1234, 1236, 1238, 1240, 1242, 1244,
    1246, 1248, 1250, 1252, 1254, 1256,
    1258, 1260, 1262, 1264, 1266, 1268,
    1270, 1272, 1274, 1276, 1278, 1280,
    1282, 1284, 1286, 1288, 1290, 1292,
    1294, 1296, 1298, 1300, 1302, 1304,
    1306, 1308, 1310, 1312, 1314, 1316,
    1318, 1320, 1322, 1324, 1326, 1073743153,
    1366, 1073746080, 4293, 4295, 4301, 7680,
    7682, 7684, 7686, 7688, 7690, 7692,
    7694, 7696, 7698, 7700, 7702, 7704,
    7706, 7708, 7710, 7712, 7714, 7716,
    7718, 7720, 7722, 7724, 7726, 7728,
    7730, 7732, 7734, 7736, 7738, 7740,
    7742, 7744, 7746, 7748, 7750, 7752,
    7754, 7756, 7758, 7760, 7762, 7764,
    7766, 7768, 7770, 7772, 7774, 7776,
    7778, 7780, 7782, 7784, 7786, 7788,
    7790, 7792, 7794, 7796, 7798, 7800,
    7802, 7804, 7806, 7808, 7810, 7812,
    7814, 7816, 7818, 7820, 7822, 7824,
    7826, 7828, 7838, 7840, 7842, 7844,
    7846, 7848, 7850, 7852, 7854, 7856,
    7858, 7860, 7862, 7864, 7866, 7868,
    7870, 7872, 7874, 7876, 7878, 7880,
    7882, 7884, 7886, 7888, 7890, 7892,
    7894, 7896, 7898, 7900, 7902, 7904,
    7906, 7908, 7910, 7912, 7914, 7916,
    7918, 7920, 7922, 7924, 7926, 7928,
    7930, 7932, 7934, 1073749768, 7951, 1073749784,
    7965, 1073749800, 7983, 1073749816, 7999, 1073749832,
    8013, 8025, 8027, 8029, 8031, 1073749864,
    8047, 1073749944, 8123, 1073749960, 8139, 1073749976,
    8155, 1073749992, 8172, 1073750008, 8187};

static const uint16_t kUppercaseTable1Size = 86;
static const int32_t kUppercaseTable1[86] = {
    258, 263, 1073742091, 269, 1073742096, 274, 277,
    1073742105, 285, 292, 294, 296, 1073742122, 301,
    1073742128, 307, 1073742142, 319, 325, 387, 1073744896,
    3118, 3168, 1073744994, 3172, 3175, 3177, 3179,
    1073745005, 3184, 3186, 3189, 1073745022, 3200, 3202,
    3204, 3206, 3208, 3210, 3212, 3214, 3216,
    3218, 3220, 3222, 3224, 3226, 3228, 3230,
    3232, 3234, 3236, 3238, 3240, 3242, 3244,
    3246, 3248, 3250, 3252, 3254, 3256, 3258,
    3260, 3262, 3264, 3266, 3268, 3270, 3272,
    3274, 3276, 3278, 3280, 3282, 3284, 3286,
    3288, 3290, 3292, 3294, 3296, 3298, 3307,
    3309, 3314};

static const uint16_t kUppercaseTable5Size = 101;
static const int32_t kUppercaseTable5[101] = {
    1600, 1602, 1604, 1606, 1608, 1610, 1612, 1614, 1616, 1618,
    1620, 1622, 1624, 1626, 1628, 1630, 1632, 1634, 1636, 1638,
    1640, 1642, 1644, 1664, 1666, 1668, 1670, 1672, 1674, 1676,
    1678, 1680, 1682, 1684, 1686, 1688, 1690, 1826, 1828, 1830,
    1832, 1834, 1836, 1838, 1842, 1844, 1846, 1848, 1850, 1852,
    1854, 1856, 1858, 1860, 1862, 1864, 1866, 1868, 1870, 1872,
    1874, 1876, 1878, 1880, 1882, 1884, 1886, 1888, 1890, 1892,
    1894, 1896, 1898, 1900, 1902, 1913, 1915, 1073743741, 1918, 1920,
    1922, 1924, 1926, 1931, 1933, 1936, 1938, 1942, 1944, 1946,
    1948, 1950, 1952, 1954, 1956, 1958, 1960, 1073743786, 1965, 1073743792,
    1969};

static const uint16_t kUppercaseTable7Size = 2;
static const int32_t kUppercaseTable7[2] = {1073749793, 7994};

inline bool IsUppercase(uchar c) {
  int chunk_index = c >> 13;
  switch (chunk_index) {
  case 0:
    return LookupPredicate(kUppercaseTable0, kUppercaseTable0Size, c);
  case 1:
    return LookupPredicate(kUppercaseTable1, kUppercaseTable1Size, c);
  case 5:
    return LookupPredicate(kUppercaseTable5, kUppercaseTable5Size, c);
  case 7:
    return LookupPredicate(kUppercaseTable7, kUppercaseTable7Size, c);
  default:
    return false;
  }
}


static const uint16_t kLetterTable0Size = 431;
static const int32_t kLetterTable0[431] = {
    1073741889, 90, 1073741921, 122, 170, 181,
    186, 1073742016, 214, 1073742040, 246, 1073742072,
    705, 1073742534, 721, 1073742560, 740, 748,
    750, 1073742704, 884, 1073742710, 887, 1073742714,
    893, 895, 902, 1073742728, 906, 908,
    1073742734, 929, 1073742755, 1013, 1073742839, 1153,
    1073742986, 1327, 1073743153, 1366, 1369, 1073743201,
    1415, 1073743312, 1514, 1073743344, 1522, 1073743392,
    1610, 1073743470, 1647, 1073743473, 1747, 1749,
    1073743589, 1766, 1073743598, 1775, 1073743610, 1788,
    1791, 1808, 1073743634, 1839, 1073743693, 1957,
    1969, 1073743818, 2026, 1073743860, 2037, 2042,
    1073743872, 2069, 2074, 2084, 2088, 1073743936,
    2136, 1073744032, 2226, 1073744132, 2361, 2365,
    2384, 1073744216, 2401, 1073744241, 2432, 1073744261,
    2444, 1073744271, 2448, 1073744275, 2472, 1073744298,
    2480, 2482, 1073744310, 2489, 2493, 2510,
    1073744348, 2525, 1073744351, 2529, 1073744368, 2545,
    1073744389, 2570, 1073744399, 2576, 1073744403, 2600,
    1073744426, 2608, 1073744434, 2611, 1073744437, 2614,
    1073744440, 2617, 1073744473, 2652, 2654, 1073744498,
    2676, 1073744517, 2701, 1073744527, 2705, 1073744531,
    2728, 1073744554, 2736, 1073744562, 2739, 1073744565,
    2745, 2749, 2768, 1073744608, 2785, 1073744645,
    2828, 1073744655, 2832, 1073744659, 2856, 1073744682,
    2864, 1073744690, 2867, 1073744693, 2873, 2877,
    1073744732, 2909, 1073744735, 2913, 2929, 2947,
    1073744773, 2954, 1073744782, 2960, 1073744786, 2965,
    1073744793, 2970, 2972, 1073744798, 2975, 1073744803,
    2980, 1073744808, 2986, 1073744814, 3001, 3024,
    1073744901, 3084, 1073744910, 3088, 1073744914, 3112,
    1073744938, 3129, 3133, 1073744984, 3161, 1073744992,
    3169, 1073745029, 3212, 1073745038, 3216, 1073745042,
    3240, 1073745066, 3251, 1073745077, 3257, 3261,
    3294, 1073745120, 3297, 1073745137, 3314, 1073745157,
    3340, 1073745166, 3344, 1073745170, 3386, 3389,
    3406, 1073745248, 3425, 1073745274, 3455, 1073745285,
    3478, 1073745306, 3505, 1073745331, 3515, 3517,
    1073745344, 3526, 1073745409, 3632, 1073745458, 3635,
    1073745472, 3654, 1073745537, 3714, 3716, 1073745543,
    3720, 3722, 3725, 1073745556, 3735, 1073745561,
    3743, 1073745569, 3747, 3749, 3751, 1073745578,
    3755, 1073745581, 3760, 1073745586, 3763, 3773,
    1073745600, 3780, 3782, 1073745628, 3807, 3840,
    1073745728, 3911, 1073745737, 3948, 1073745800, 3980,
    1073745920, 4138, 4159, 1073746000, 4181, 1073746010,
    4189, 4193, 1073746021, 4198, 1073746030, 4208,
    1073746037, 4225, 4238, 1073746080, 4293, 4295,
    4301, 1073746128, 4346, 1073746172, 4680, 1073746506,
    4685, 1073746512, 4694, 4696, 1073746522, 4701,
    1073746528, 4744, 1073746570, 4749, 1073746576, 4784,
    1073746610, 4789, 1073746616, 4798, 4800, 1073746626,
    4805, 1073746632, 4822, 1073746648, 4880, 1073746706,
    4885, 1073746712, 4954, 1073746816, 5007, 1073746848,
    5108, 1073746945, 5740, 1073747567, 5759, 1073747585,
    5786, 1073747616, 5866, 1073747694, 5880, 1073747712,
    5900, 1073747726, 5905, 1073747744, 5937, 1073747776,
    5969, 1073747808, 5996, 1073747822, 6000, 1073747840,
    6067, 6103, 6108, 1073748000, 6263, 1073748096,
    6312, 6314, 1073748144, 6389, 1073748224, 6430,
    1073748304, 6509, 1073748336, 6516, 1073748352, 6571,
    1073748417, 6599, 1073748480, 6678, 1073748512, 6740,
    6823, 1073748741, 6963, 1073748805, 6987, 1073748867,
    7072, 1073748910, 7087, 1073748922, 7141, 1073748992,
    7203, 1073749069, 7247, 1073749082, 7293, 1073749225,
    7404, 1073749230, 7409, 1073749237, 7414, 1073749248,
    7615, 1073749504, 7957, 1073749784, 7965, 1073749792,
    8005, 1073749832, 8013, 1073749840, 8023, 8025,
    8027, 8029, 1073749855, 8061, 1073749888, 8116,
    1073749942, 8124, 8126, 1073749954, 8132, 1073749958,
    8140, 1073749968, 8147, 1073749974, 8155, 1073749984,
    8172, 1073750002, 8180, 1073750006, 8188};

static const uint16_t kLetterTable1Size = 87;
static const int32_t kLetterTable1[87] = {
    113, 127, 1073741968, 156, 258, 263,
    1073742090, 275, 277, 1073742105, 285, 292,
    294, 296, 1073742122, 301, 1073742127, 313,
    1073742140, 319, 1073742149, 329, 334, 1073742176,
    392, 1073744896, 3118, 1073744944, 3166, 1073744992,
    3300, 1073745131, 3310, 1073745138, 3315, 1073745152,
    3365, 3367, 3373, 1073745200, 3431, 3439,
    1073745280, 3478, 1073745312, 3494, 1073745320, 3502,
    1073745328, 3510, 1073745336, 3518, 1073745344, 3526,
    1073745352, 3534, 1073745360, 3542, 1073745368, 3550,
    3631, 1073745925, 4103, 1073745953, 4137, 1073745969,
    4149, 1073745976, 4156, 1073745985, 4246, 1073746077,
    4255, 1073746081, 4346, 1073746172, 4351, 1073746181,
    4397, 1073746225, 4494, 1073746336, 4538, 1073746416,
    4607, 1073746944, 8191};

static const uint16_t kLetterTable2Size = 4;
static const int32_t kLetterTable2[4] = {1073741824, 3509, 1073745408, 8191};

static const uint16_t kLetterTable3Size = 2;
static const int32_t kLetterTable3[2] = {1073741824, 8191};

static const uint16_t kLetterTable4Size = 2;
static const int32_t kLetterTable4[2] = {1073741824, 8140};

static const uint16_t kLetterTable5Size = 100;
static const int32_t kLetterTable5[100] = {
    1073741824, 1164, 1073743056, 1277, 1073743104, 1548,
    1073743376, 1567, 1073743402, 1579, 1073743424, 1646,
    1073743487, 1693, 1073743520, 1775, 1073743639, 1823,
    1073743650, 1928, 1073743755, 1934, 1073743760, 1965,
    1073743792, 1969, 1073743863, 2049, 1073743875, 2053,
    1073743879, 2058, 1073743884, 2082, 1073743936, 2163,
    1073744002, 2227, 1073744114, 2295, 2299, 1073744138,
    2341, 1073744176, 2374, 1073744224, 2428, 1073744260,
    2482, 2511, 1073744352, 2532, 1073744358, 2543,
    1073744378, 2558, 1073744384, 2600, 1073744448, 2626,
    1073744452, 2635, 1073744480, 2678, 2682, 1073744510,
    2735, 2737, 1073744565, 2742, 1073744569, 2749,
    2752, 2754, 1073744603, 2781, 1073744608, 2794,
    1073744626, 2804, 1073744641, 2822, 1073744649, 2830,
    1073744657, 2838, 1073744672, 2854, 1073744680, 2862,
    1073744688, 2906, 1073744732, 2911, 1073744740, 2917,
    1073744832, 3042, 1073744896, 8191};

static const uint16_t kLetterTable6Size = 6;
static const int32_t kLetterTable6[6] = {1073741824, 6051, 1073747888,
                                         6086, 1073747915, 6139};

static const uint16_t kLetterTable7Size = 48;
static const int32_t kLetterTable7[48] = {
    1073748224, 6765, 1073748592, 6873, 1073748736, 6918,
    1073748755, 6935, 6941, 1073748767, 6952, 1073748778,
    6966, 1073748792, 6972, 6974, 1073748800, 6977,
    1073748803, 6980, 1073748806, 7089, 1073748947, 7485,
    1073749328, 7567, 1073749394, 7623, 1073749488, 7675,
    1073749616, 7796, 1073749622, 7932, 1073749793, 7994,
    1073749825, 8026, 1073749862, 8126, 1073749954, 8135,
    1073749962, 8143, 1073749970, 8151, 1073749978, 8156};

inline bool IsLetter(uchar c) {
  int chunk_index = c >> 13;
  switch (chunk_index) {
  case 0:
    return LookupPredicate(kLetterTable0, kLetterTable0Size, c);
  case 1:
    return LookupPredicate(kLetterTable1, kLetterTable1Size, c);
  case 2:
    return LookupPredicate(kLetterTable2, kLetterTable2Size, c);
  case 3:
    return LookupPredicate(kLetterTable3, kLetterTable3Size, c);
  case 4:
    return LookupPredicate(kLetterTable4, kLetterTable4Size, c);
  case 5:
    return LookupPredicate(kLetterTable5, kLetterTable5Size, c);
  case 6:
    return LookupPredicate(kLetterTable6, kLetterTable6Size, c);
  case 7:
    return LookupPredicate(kLetterTable7, kLetterTable7Size, c);
  default:
    return false;
  }
}

} // namespace v8_unicode